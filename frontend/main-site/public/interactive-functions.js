let currentQuizStep=1;const totalQuizSteps=4;function setTheme(e){const t=document.documentElement,n=document.getElementById("theme-icon");"dark"===e?(t.classList.add("dark"),n&&(n.classList.remove("fa-sun"),n.classList.add("fa-moon"))):(t.classList.remove("dark"),n&&(n.classList.remove("fa-moon"),n.classList.add("fa-sun"))),localStorage.setItem("theme",e)}function toggleTheme(){const e=document.documentElement,t=document.getElementById("theme-toggle-button");e.classList.contains("dark")?setTheme("light"):setTheme("dark"),t&&(t.style.transform="scale(0.95)",setTimeout(()=>{t.style.transform=""},150))}function initThemeSystem(){setTheme(localStorage.getItem("theme")||"light")}function toggleSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-toggle");if(e.classList.toggle("open"),t.classList.toggle("active"),e.classList.contains("open")){const e=document.getElementById("notification-badge");e&&(e.style.display="none")}}function closeSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-toggle");e&&e.classList.remove("open"),t&&t.classList.remove("active")}function startQuiz(){currentQuizStep=1,document.getElementById("client-quiz").reset(),document.querySelectorAll(".quiz-step").forEach((e,t)=>{e.style.display=0===t?"block":"none"}),document.getElementById("quiz-prev").style.display="none",document.getElementById("quiz-next").style.display="inline-flex",document.getElementById("quiz-submit").style.display="none",showQuizPrompt()}function showQuizPrompt(){const e=document.getElementById("quiz-modal");e&&e.classList.add("active")}function closeQuiz(){const e=document.getElementById("quiz-modal");e&&e.classList.remove("active")}function nextQuizStep(){if(currentQuizStep<4){if(!validateQuizStep(currentQuizStep))return;document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="none",currentQuizStep++,document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="block",document.getElementById("quiz-prev").style.display="inline-flex",4===currentQuizStep&&(document.getElementById("quiz-next").style.display="none",document.getElementById("quiz-submit").style.display="inline-flex")}}function prevQuizStep(){currentQuizStep>1&&(document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="none",currentQuizStep--,document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="block",1===currentQuizStep&&(document.getElementById("quiz-prev").style.display="none"),document.getElementById("quiz-next").style.display="inline-flex",document.getElementById("quiz-submit").style.display="none")}function validateQuizStep(e){const t=document.querySelector(`[data-step="${e}"]`),n=t.querySelectorAll("[required]");for(let e of n)if("radio"===e.type||"checkbox"===e.type){const n=e.name;if(0===t.querySelectorAll(`[name="${n}"]:checked`).length)return showToast('<i class="fas fa-exclamation-circle"></i> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è',"error"),!1}else if(!e.value.trim())return showToast('<i class="fas fa-exclamation-circle"></i> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è',"error"),e.focus(),!1;return!0}async function submitQuiz(){if(!validateQuizStep(currentQuizStep))return;const e=document.getElementById("client-quiz"),t=new FormData(e);Object.fromEntries(t.entries());try{await new Promise(e=>setTimeout(e,2e3)),showToast('<i class="fas fa-check-circle"></i> –ê–Ω–∫–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.',"success"),localStorage.setItem("quiz-completed","true"),closeQuiz()}catch(e){showToast('<i class="fas fa-times-circle"></i> –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∞–Ω–∫–µ—Ç—ã',"error")}}function showToast(e,t="success"){const n=document.createElement("div");n.className=`toast ${t} show`,n.innerHTML=`\n        <div style="display: flex; justify-content: space-between; align-items: center;">\n            <span>${e}</span>\n            <button data-close-toast style="background: none; border: none; color: inherit; cursor: pointer; font-size: 18px; margin-left: 10px;">√ó</button>\n        </div>\n    `,document.body.appendChild(n),n.querySelector("[data-close-toast]").addEventListener("click",function(){n.remove()}),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>{n.parentNode&&n.remove()},300)},5e3)}function initStarRating(){const e=document.getElementById("review-rating");if(!e)return;const t=e.querySelectorAll(".star"),n=document.getElementById("rating-value");let s=0;t.forEach((e,o)=>{e.addEventListener("mouseenter",()=>{highlightStars(t,o+1)}),e.addEventListener("mouseleave",()=>{highlightStars(t,s)}),e.addEventListener("click",()=>{s=o+1,n.value=s,highlightStars(t,s)})})}function highlightStars(e,t){e.forEach((e,n)=>{n<t?e.classList.add("active"):e.classList.remove("active")})}document.addEventListener("DOMContentLoaded",function(){initThemeSystem(),initStarRating(),initChatSystem();const e=document.getElementById("theme-toggle-button");e&&e.addEventListener("click",toggleTheme);const t=document.getElementById("sidebar-toggle");t&&t.addEventListener("click",toggleSidebar);const n=document.getElementById("quiz-next");n&&n.addEventListener("click",nextQuizStep);const s=document.getElementById("quiz-prev");s&&s.addEventListener("click",prevQuizStep);const o=document.getElementById("quiz-submit");o&&o.addEventListener("click",submitQuiz),document.querySelectorAll("[data-close-quiz]").forEach(e=>{e.addEventListener("click",closeQuiz)}),document.querySelectorAll("[data-close-sidebar]").forEach(e=>{e.addEventListener("click",closeSidebar)}),document.querySelectorAll("[data-start-quiz]").forEach(e=>{e.addEventListener("click",startQuiz)}),document.addEventListener("click",e=>{const t=document.getElementById("sidebar"),n=document.getElementById("sidebar-toggle");t&&n&&!t.contains(e.target)&&!n.contains(e.target)&&closeSidebar()});const i=document.getElementById("review-form"),a=document.getElementById("review-counter"),c=document.getElementById("review-text");c&&a&&c.addEventListener("input",()=>{const e=c.value.length;a.textContent=e,a.style.color=e>1e3?"#ff4757":"var(--text-secondary)"}),i&&i.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(i);if("0"===Object.fromEntries(t.entries()).rating)return void showToast('<i class="fas fa-star"></i> –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ—Å—Ç–∞–≤—å—Ç–µ –æ—Ü–µ–Ω–∫—É',"error");const n=i.querySelector('button[type="submit"]'),s=n.innerHTML;n.innerHTML='<i class="fas fa-spinner fa-spin"></i> –û—Ç–ø—Ä–∞–≤–ª—è–µ–º...',n.disabled=!0;try{await new Promise(e=>setTimeout(e,1500)),showToast('<i class="fas fa-check-circle"></i> –û—Ç–∑—ã–≤ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–Ω –±—É–¥–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω –ø–æ—Å–ª–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏.',"success"),i.reset(),document.getElementById("rating-value").value="0",document.getElementById("review-counter").textContent="0",highlightStars(document.querySelectorAll("#review-rating .star"),0)}catch(e){showToast('<i class="fas fa-times-circle"></i> –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç–∑—ã–≤–∞',"error")}finally{n.innerHTML=s,n.disabled=!1}}),setTimeout(()=>{localStorage.getItem("quiz-completed")||showQuizPrompt()},3e3)});let unreadMessagesCount=0,chatOpen=!1,userId="user_"+Math.random().toString(36).substr(2,9),userName="–ö–ª–∏–µ–Ω—Ç";function toggleChat(){const e=document.getElementById("chat-sidebar"),t=document.getElementById("chat-notification-button");chatOpen=!chatOpen,chatOpen?(e.classList.add("open"),unreadMessagesCount=0,updateNotificationBadge(),scrollChatToBottom()):e.classList.remove("open"),t&&(t.style.transform="scale(0.95)",setTimeout(()=>{t.style.transform=""},150))}function closeChat(){document.getElementById("chat-sidebar").classList.remove("open"),chatOpen=!1}function updateNotificationBadge(){const e=document.getElementById("chat-notification-badge");e&&(unreadMessagesCount>0?(e.textContent=unreadMessagesCount>99?"99+":unreadMessagesCount,e.classList.add("show")):e.classList.remove("show"))}function displayChatMessage(e,t=!1){const n=document.getElementById("chat-messages");if(!n)return;const s=document.createElement("div");s.className="message-bubble "+(t?"message-self":"message-other");const o=(new Date).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});s.innerHTML=`\n        ${t?"":'<div class="message-info">–ú–∞—Ä–∏–Ω–∞ –ß–∏–∫–∞–∏–¥–∑–µ ‚Ä¢ –ü—Å–∏—Ö–æ–ª–æ–≥</div>'}\n        <div class="message-text">${e}</div>\n        <div class="message-time">${o}</div>\n    `,n.appendChild(s),scrollChatToBottom(),chatOpen||t||(unreadMessagesCount++,updateNotificationBadge())}function scrollChatToBottom(){const e=document.getElementById("chat-messages");e&&setTimeout(()=>{e.scrollTop=e.scrollHeight},100)}function sendChatMessage(){const e=document.getElementById("chat-message-input");if(!e)return;const t=e.value.trim();if(""===t)return;displayChatMessage(t,!0),e.value="";const n=["–ü–æ–Ω–∏–º–∞—é –≤–∞—à–∏ —á—É–≤—Å—Ç–≤–∞. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç? ü§ó","–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–∞–∂–Ω–∞—è —Ç–µ–º–∞. –ö–∞–∫ –¥–æ–ª–≥–æ –≤—ã —Å —ç—Ç–∏–º —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç–µ—Å—å?","–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø–æ–¥–µ–ª–∏–ª–∏—Å—å. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º —ç—Ç—É —Å–∏—Ç—É–∞—Ü–∏—é –≤–º–µ—Å—Ç–µ.","–Ø –≤–∏–∂—É, —á—Ç–æ —ç—Ç–æ –¥–ª—è –≤–∞—Å –∑–Ω–∞—á–∏–º–æ. –ö–∞–∫–∏–µ —ç–º–æ—Ü–∏–∏ –≤—ã –∏—Å–ø—ã—Ç—ã–≤–∞–µ—Ç–µ?","–•–æ—Ä–æ—à–æ, —á—Ç–æ –≤—ã –æ–±—Ä–∞—Ç–∏–ª–∏—Å—å –∑–∞ –ø–æ–º–æ—â—å—é. –≠—Ç–æ –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ —Ä–µ—à–µ–Ω–∏—é! üí™","–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è. –ê –∫–∞–∫ –≤—ã —Å–∞–º–∏ –≤–∏–¥–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –ø—É—Ç–∏ —Ä–µ—à–µ–Ω–∏—è?","–î–∞–≤–∞–π—Ç–µ –ø–æ–ø—Ä–æ–±—É–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —ç—Ç–æ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã...","–Ø –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å –≤–∞–º –≤ —ç—Ç–æ–º. –•–æ—Ç–µ–ª–∏ –±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é? üìÖ"];setTimeout(()=>{displayChatMessage(n[Math.floor(Math.random()*n.length)],!1),chatOpen||showToast('<i class="fas fa-comments"></i> –ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø—Å–∏—Ö–æ–ª–æ–≥–∞',"success")},1e3+2e3*Math.random())}function initChatSystem(){const e=document.getElementById("chat-notification-button"),t=document.getElementById("close-chat-button"),n=document.getElementById("chat-send-button"),s=document.getElementById("chat-message-input");e&&e.addEventListener("click",toggleChat),t&&t.addEventListener("click",closeChat),n&&n.addEventListener("click",sendChatMessage),s&&s.addEventListener("keypress",e=>{"Enter"===e.key&&sendChatMessage()}),document.addEventListener("click",e=>{const t=document.getElementById("chat-sidebar"),n=document.getElementById("chat-notification-button");t&&n&&!t.contains(e.target)&&!n.contains(e.target)&&chatOpen&&closeChat()}),setTimeout(()=>{0===unreadMessagesCount&&displayChatMessage("–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã - –ø–∏—à–∏—Ç–µ! –Ø –æ–Ω–ª–∞–π–Ω –∏ –≥–æ—Ç–æ–≤–∞ –ø–æ–º–æ—á—å üòä",!1)},8e3),setTimeout(()=>{0===unreadMessagesCount&&displayChatMessage("üí° –°–æ–≤–µ—Ç –¥–Ω—è: –í—ã–¥–µ–ª–∏—Ç–µ 5 –º–∏–Ω—É—Ç –Ω–∞ –≥–ª—É–±–æ–∫–æ–µ –¥—ã—Ö–∞–Ω–∏–µ - —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å —Å—Ç—Ä–µ—Å—Å",!1)},2e4),setTimeout(()=>{0===unreadMessagesCount&&displayChatMessage("üìñ –ü–æ–º–Ω–∏—Ç–µ: –∫–∞–∂–¥—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —à–∞–≥ –∫ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º—É –∑–¥–æ—Ä–æ–≤—å—é –≤–∞–∂–µ–Ω!",!1)},45e3)}window.toggleTheme=toggleTheme,window.setTheme=setTheme,window.toggleSidebar=toggleSidebar,window.closeSidebar=closeSidebar,window.startQuiz=startQuiz,window.closeQuiz=closeQuiz,window.nextQuizStep=nextQuizStep,window.prevQuizStep=prevQuizStep,window.submitQuiz=submitQuiz,window.showToast=showToast,window.toggleChat=toggleChat,window.closeChat=closeChat,window.sendChatMessage=sendChatMessage;