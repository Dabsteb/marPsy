let currentQuizStep=1;const totalQuizSteps=4;function toggleTheme(){const e="dark"===document.body.getAttribute("data-theme")?"light":"dark";document.body.classList.add("theme-transition"),createThemeTransitionEffect(e),setTimeout(()=>{setTheme(e),localStorage.setItem("theme",e),setTimeout(()=>{document.body.classList.remove("theme-transition")},400)},100)}function setTheme(e){document.body.setAttribute("data-theme",e),updateThemeIcon(e,!0)}function updateThemeIcon(e,t=!1){const n=document.getElementById("theme-icon");n&&(t?(n.style.transform="rotate(180deg) scale(0.8)",setTimeout(()=>{"dark"===e?(n.className="fas fa-moon",n.style.color="#ffd43b"):(n.className="fas fa-sun",n.style.color="#ff6b35"),n.style.transform="rotate(0deg) scale(1)"},200)):"dark"===e?(n.className="fas fa-moon",n.style.color="#ffd43b"):(n.className="fas fa-sun",n.style.color="#ff6b35"))}function createThemeTransitionEffect(e){const t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100vw",t.style.height="100vh",t.style.pointerEvents="none",t.style.zIndex="99999",t.style.opacity="0","dark"===e?(t.style.background="radial-gradient(circle at center, rgba(102, 126, 234, 0.3) 0%, rgba(15, 15, 26, 0.8) 70%)",t.style.animation="darkThemeWave 0.6s ease-out forwards"):(t.style.background="radial-gradient(circle at center, rgba(255, 255, 255, 0.9) 0%, rgba(248, 250, 252, 0.7) 70%)",t.style.animation="lightThemeWave 0.6s ease-out forwards"),document.body.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},600)}function initThemeSystem(){const e=localStorage.getItem("theme"),t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";setTheme(e||t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||setTheme(e.matches?"dark":"light")})}function addThemeTransitionStyles(){if(!document.querySelector("#theme-transition-styles")){const e=document.createElement("style");e.id="theme-transition-styles",e.textContent='\n            /* Анимации для переходов между темами */\n            @keyframes darkThemeWave {\n                0% {\n                    opacity: 0;\n                    transform: scale(0) rotate(0deg);\n                }\n                50% {\n                    opacity: 1;\n                    transform: scale(1.2) rotate(180deg);\n                }\n                100% {\n                    opacity: 0;\n                    transform: scale(2.5) rotate(360deg);\n                }\n            }\n            \n            @keyframes lightThemeWave {\n                0% {\n                    opacity: 0;\n                    transform: scale(0);\n                    filter: brightness(0.5);\n                }\n                50% {\n                    opacity: 1;\n                    transform: scale(1.2);\n                    filter: brightness(1.2);\n                }\n                100% {\n                    opacity: 0;\n                    transform: scale(2.5);\n                    filter: brightness(2);\n                }\n            }\n            \n            /* Дополнительные анимации для элементов */\n            .theme-transition .btn,\n            .theme-transition .sidebar,\n            .theme-transition .theme-toggle,\n            .theme-transition .toast {\n                animation: elementGlow 0.6s ease-in-out;\n            }\n            \n            @keyframes elementGlow {\n                0%, 100% { filter: brightness(1); }\n                50% { filter: brightness(1.3); }\n            }\n            \n            /* Плавная анимация для иконок */\n            .fas, .fab, .far {\n                transition: transform 0.3s ease, color 0.3s ease, filter 0.3s ease !important;\n            }\n            \n            /* Анимация свечения для темной темы */\n            [data-theme="dark"] .btn:hover,\n            [data-theme="dark"] .theme-toggle:hover {\n                animation: darkGlow 2s ease-in-out infinite;\n            }\n            \n            @keyframes darkGlow {\n                0%, 100% { box-shadow: var(--shadow-elevated), var(--glow-button); }\n                50% { box-shadow: var(--shadow-elevated), var(--glow-accent); }\n            }\n        ',document.head.appendChild(e)}}function toggleSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-toggle");if(e.classList.toggle("open"),t.classList.toggle("active"),e.classList.contains("open")){const e=document.getElementById("notification-badge");e&&(e.style.display="none")}}function closeSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-toggle");e&&e.classList.remove("open"),t&&t.classList.remove("active")}function startQuiz(){currentQuizStep=1,document.getElementById("client-quiz").reset(),document.querySelectorAll(".quiz-step").forEach((e,t)=>{e.style.display=0===t?"block":"none"}),document.getElementById("quiz-prev").style.display="none",document.getElementById("quiz-next").style.display="inline-flex",document.getElementById("quiz-submit").style.display="none",showQuizPrompt()}function showQuizPrompt(){const e=document.getElementById("quiz-modal");e&&e.classList.add("active")}function closeQuiz(){const e=document.getElementById("quiz-modal");e&&e.classList.remove("active")}function nextQuizStep(){if(currentQuizStep<4){if(!validateQuizStep(currentQuizStep))return;document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="none",currentQuizStep++,document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="block",document.getElementById("quiz-prev").style.display="inline-flex",4===currentQuizStep&&(document.getElementById("quiz-next").style.display="none",document.getElementById("quiz-submit").style.display="inline-flex")}}function prevQuizStep(){currentQuizStep>1&&(document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="none",currentQuizStep--,document.querySelector(`[data-step="${currentQuizStep}"]`).style.display="block",1===currentQuizStep&&(document.getElementById("quiz-prev").style.display="none"),document.getElementById("quiz-next").style.display="inline-flex",document.getElementById("quiz-submit").style.display="none")}function validateQuizStep(e){const t=document.querySelector(`[data-step="${e}"]`),n=t.querySelectorAll("[required]");for(let e of n)if("radio"===e.type||"checkbox"===e.type){const n=e.name;if(0===t.querySelectorAll(`[name="${n}"]:checked`).length)return showToast('<i class="fas fa-exclamation-circle"></i> Пожалуйста, заполните все обязательные поля',"error"),!1}else if(!e.value.trim())return showToast('<i class="fas fa-exclamation-circle"></i> Пожалуйста, заполните все обязательные поля',"error"),e.focus(),!1;return!0}async function submitQuiz(){if(!validateQuizStep(currentQuizStep))return;const e=document.getElementById("client-quiz"),t=new FormData(e);Object.fromEntries(t.entries());try{await new Promise(e=>setTimeout(e,2e3)),showToast('<i class="fas fa-check-circle"></i> Анкета успешно отправлена! Мы свяжемся с вами в ближайшее время.',"success"),localStorage.setItem("quiz-completed","true"),closeQuiz()}catch(e){showToast('<i class="fas fa-times-circle"></i> Ошибка при отправке анкеты',"error")}}function showToast(e,t="success"){const n=document.createElement("div");n.className=`toast ${t} show`,n.innerHTML=`\n        <div style="display: flex; justify-content: space-between; align-items: center;">\n            <span>${e}</span>\n            <button data-close-toast style="background: none; border: none; color: inherit; cursor: pointer; font-size: 18px; margin-left: 10px;">×</button>\n        </div>\n    `,document.body.appendChild(n),n.querySelector("[data-close-toast]").addEventListener("click",function(){n.remove()}),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>{n.parentNode&&n.remove()},300)},5e3)}function initStarRating(){const e=document.getElementById("review-rating");if(!e)return;const t=e.querySelectorAll(".star"),n=document.getElementById("rating-value");let i=0;t.forEach((e,o)=>{e.addEventListener("mouseenter",()=>{highlightStars(t,o+1)}),e.addEventListener("mouseleave",()=>{highlightStars(t,i)}),e.addEventListener("click",()=>{i=o+1,n.value=i,highlightStars(t,i)})})}function highlightStars(e,t){e.forEach((e,n)=>{n<t?e.classList.add("active"):e.classList.remove("active")})}document.addEventListener("DOMContentLoaded",function(){initThemeSystem(),addThemeTransitionStyles(),initStarRating();const e=document.getElementById("theme-toggle");e&&e.addEventListener("click",toggleTheme);const t=document.getElementById("sidebar-toggle");t&&t.addEventListener("click",toggleSidebar);const n=document.getElementById("quiz-next");n&&n.addEventListener("click",nextQuizStep);const i=document.getElementById("quiz-prev");i&&i.addEventListener("click",prevQuizStep);const o=document.getElementById("quiz-submit");o&&o.addEventListener("click",submitQuiz),document.querySelectorAll("[data-close-quiz]").forEach(e=>{e.addEventListener("click",closeQuiz)}),document.querySelectorAll("[data-close-sidebar]").forEach(e=>{e.addEventListener("click",closeSidebar)}),document.querySelectorAll("[data-start-quiz]").forEach(e=>{e.addEventListener("click",startQuiz)}),document.addEventListener("click",e=>{const t=document.getElementById("sidebar"),n=document.getElementById("sidebar-toggle");t&&n&&!t.contains(e.target)&&!n.contains(e.target)&&closeSidebar()});const s=document.getElementById("review-form"),a=document.getElementById("review-counter"),r=document.getElementById("review-text");r&&a&&r.addEventListener("input",()=>{const e=r.value.length;a.textContent=e,a.style.color=e>1e3?"#ff4757":"var(--text-secondary)"}),s&&s.addEventListener("submit",async e=>{e.preventDefault();const t=new FormData(s);if("0"===Object.fromEntries(t.entries()).rating)return void showToast('<i class="fas fa-star"></i> Пожалуйста, поставьте оценку',"error");const n=s.querySelector('button[type="submit"]'),i=n.innerHTML;n.innerHTML='<i class="fas fa-spinner fa-spin"></i> Отправляем...',n.disabled=!0;try{await new Promise(e=>setTimeout(e,1500)),showToast('<i class="fas fa-check-circle"></i> Отзыв успешно отправлен! Он будет опубликован после модерации.',"success"),s.reset(),document.getElementById("rating-value").value="0",document.getElementById("review-counter").textContent="0",highlightStars(document.querySelectorAll("#review-rating .star"),0)}catch(e){showToast('<i class="fas fa-times-circle"></i> Ошибка при отправке отзыва',"error")}finally{n.innerHTML=i,n.disabled=!1}}),setTimeout(()=>{localStorage.getItem("quiz-completed")||showQuizPrompt()},3e3)}),window.toggleTheme=toggleTheme,window.setTheme=setTheme,window.toggleSidebar=toggleSidebar,window.closeSidebar=closeSidebar,window.startQuiz=startQuiz,window.closeQuiz=closeQuiz,window.nextQuizStep=nextQuizStep,window.prevQuizStep=prevQuizStep,window.submitQuiz=submitQuiz,window.showToast=showToast;