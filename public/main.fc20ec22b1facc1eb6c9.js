!function(){"use strict";window.startQuiz=function(){window.website&&window.website.startQuiz()},window.closeQuiz=function(){window.website&&window.website.closeQuiz()},window.nextQuizStep=function(){window.website&&window.website.nextQuizStep()},window.prevQuizStep=function(){window.website&&window.website.prevQuizStep()},window.closeSidebar=function(){window.website&&window.website.closeSidebar()};const e=new class{constructor(){this.init()}init(){console.log("Психологический кабинет v2.0 загружен"),this.initNavigation(),this.initScrollEffects(),this.initFormHandling(),this.initReviewForm(),this.initThemeToggle(),this.initSidebar(),this.initStarRating(),this.initQuiz(),this.initAnimations(),this.checkApiStatus(),this.currentQuizStep=1,this.totalQuizSteps=4,"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.onDOMReady()):this.onDOMReady()}onDOMReady(){this.addScrollListeners(),this.initIntersectionObserver(),this.addInteractivity()}initNavigation(){const e=document.getElementById("navbar"),t=document.getElementById("nav-toggle"),i=document.getElementById("nav-menu"),s=document.querySelectorAll(".nav-link");t&&i&&t.addEventListener("click",()=>{i.classList.toggle("active"),this.toggleNavIcon(t)}),s.forEach(e=>{e.addEventListener("click",s=>{const n=e.getAttribute("href");n&&n.startsWith("#")&&(s.preventDefault(),this.smoothScrollTo(n.substring(1)),i&&(i.classList.remove("active"),this.toggleNavIcon(t,!1)))})}),e&&window.addEventListener("scroll",()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")})}toggleNavIcon(e,t=null){if(!e)return;const i=e.querySelectorAll("span");(null!==t?!t:e.classList.contains("active"))?(e.classList.remove("active"),i[0].style.transform="rotate(0deg) translateY(0px)",i[1].style.opacity="1",i[2].style.transform="rotate(0deg) translateY(0px)"):(e.classList.add("active"),i[0].style.transform="rotate(45deg) translateY(7px)",i[1].style.opacity="0",i[2].style.transform="rotate(-45deg) translateY(-7px)")}smoothScrollTo(e){const t=document.getElementById(e);if(t){const e=t.offsetTop-80;window.scrollTo({top:e,behavior:"smooth"})}}initScrollEffects(){this.observerOptions={threshold:.1,rootMargin:"0px 0px -50px 0px"}}initIntersectionObserver(){if(!window.IntersectionObserver)return void document.querySelectorAll(".slide-up").forEach(e=>{e.classList.add("visible")});const e=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){e.target.classList.add("visible");const t=e.target.dataset.delay||0;setTimeout(()=>{e.target.style.transitionDelay=`${t}ms`},100)}})},this.observerOptions);document.querySelectorAll(".slide-up, .service-card, .testimonial-card").forEach((t,i)=>{t.dataset.delay=100*i,e.observe(t)})}initFormHandling(){const e=document.getElementById("contact-form");e&&e.addEventListener("submit",async t=>{t.preventDefault(),await this.handleFormSubmission(e)}),this.addRealTimeValidation()}async handleFormSubmission(e){const t=new FormData(e),i=Object.fromEntries(t.entries());console.log("Отправка формы:",i);const s=e.querySelector('button[type="submit"]'),n=s.innerHTML;s.innerHTML='<span><i class="fas fa-spinner fa-spin"></i> Отправляем...</span>',s.disabled=!0;try{if(!(await this.submitToAPI(i)).success)throw new Error("Ошибка сервера");this.showNotification('<i class="fas fa-check-circle"></i> Спасибо за заявку! Мы свяжемся с вами в ближайшее время.',"success"),e.reset(),this.sendToWhatsApp(i)}catch(e){console.error("Ошибка отправки:",e),this.showNotification('<i class="fas fa-times-circle"></i> Произошла ошибка. Попробуйте связаться с нами по телефону.',"error")}finally{s.innerHTML=n,s.disabled=!1}}async submitToAPI(e){const t=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),credentials:"include"});if(!t.ok){const e=await t.json();throw new Error(e.message||"Ошибка сервера")}return t.json()}sendToWhatsApp(e){const t=`Заявка с сайта:\nИмя: ${e.name}\nТелефон: ${e.phone}\nУслуга: ${e.service}\n${e.email?`Email: ${e.email}`:""}\n${e.message?`Сообщение: ${e.message}`:""}`,i=`https://wa.me/79197448522?text=${encodeURIComponent(t)}`;setTimeout(()=>{window.open(i,"_blank")},2e3)}addRealTimeValidation(){const e=document.getElementById("contact-form");e&&e.querySelectorAll("input[required], select[required], textarea[required]").forEach(e=>{e.addEventListener("blur",()=>{this.validateField(e)}),e.addEventListener("input",()=>{if(e.classList.contains("error")){e.classList.remove("error");const t=e.parentNode.querySelector(".field-error");t&&t.remove()}})})}validateField(e){const t=e.value.trim();let i=!0,s="";e.classList.remove("error");const n=e.parentNode.querySelector(".field-error");if(n&&n.remove(),"name"===e.name&&t.length<2?(i=!1,s="Введите ваше имя"):"phone"===e.name?/^(\+7|8)?[\s\-]?\(?\d{3}\)?[\s\-]?\d{3}[\s\-]?\d{2}[\s\-]?\d{2}$/.test(t)||(i=!1,s="Введите корректный номер телефона"):"email"===e.name&&t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||(i=!1,s="Введите корректный email"):"service"!==e.name||t||(i=!1,s="Выберите тип консультации"),!i){e.classList.add("error");const t=document.createElement("div");t.className="field-error",t.textContent=s,t.style.color="#e53e3e",t.style.fontSize="0.875rem",t.style.marginTop="0.25rem",e.parentNode.appendChild(t)}return i}initAnimations(){setTimeout(()=>{document.body.classList.add("loaded")},100)}addScrollListeners(){let e=!1;window.addEventListener("scroll",()=>{e||(requestAnimationFrame(()=>{this.updateScrollProgress(),this.handleParallax(),e=!1}),e=!0)},{passive:!0})}updateScrollProgress(){const e=window.pageYOffset/(document.documentElement.scrollHeight-window.innerHeight)*100,t=document.querySelector(".scroll-progress");t&&(t.style.width=`${e}%`)}handleParallax(){const e=window.pageYOffset;document.querySelectorAll(".floating-shapes").forEach(t=>{t.style.transform=`translateY(${.5*e}px)`})}addInteractivity(){document.querySelectorAll(".btn").forEach(e=>{e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-3px)"}),e.addEventListener("mouseleave",()=>{e.style.transform=""})}),document.querySelectorAll(".service-card").forEach(e=>{e.addEventListener("mouseenter",()=>{e.style.transform="translateY(-8px) rotateX(5deg)"}),e.addEventListener("mouseleave",()=>{e.style.transform=""})})}async checkApiStatus(){try{const e=await fetch("/api/health"),t=await e.json();if(!t.success)throw new Error("API недоступно");console.log("API подключен:",t.message),this.showApiStatus(!0)}catch(e){console.warn("⚠️ API недоступно:",e.message),this.showApiStatus(!1)}}showApiStatus(e){const t=document.createElement("div");t.id="api-status",t.style.cssText=`\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            padding: 8px 12px;\n            border-radius: 20px;\n            font-size: 12px;\n            z-index: 1000;\n            transition: all 0.3s ease;\n            ${e?"background: #48bb78; color: white;":"background: #f56565; color: white;"}\n        `,t.innerHTML=e?'<i class="fas fa-check-circle" style="color: green"></i> Онлайн':'<i class="fas fa-times-circle" style="color: red"></i> Офлайн';const i=document.getElementById("api-status");i&&i.remove(),document.body.appendChild(t),setTimeout(()=>{t.parentNode&&(t.style.opacity="0",setTimeout(()=>{t.remove()},300))},3e3)}showNotification(e,t="success"){document.querySelectorAll(".notification").forEach(e=>e.remove());const i=document.createElement("div");i.className=`notification ${t}`,i.innerHTML=`\n            <div class="notification-content">\n                <span class="notification-message">${e}</span>\n                <button class="notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n            </div>\n        `,document.body.appendChild(i),setTimeout(()=>{i.classList.add("show")},100),setTimeout(()=>{i.classList.remove("show"),setTimeout(()=>{i.parentNode&&i.remove()},300)},5e3)}debounce(e,t){let i;return function(...s){clearTimeout(i),i=setTimeout(()=>{clearTimeout(i),e(...s)},t)}}throttle(e,t){let i;return function(){const s=arguments;i||(e.apply(this,s),i=!0,setTimeout(()=>i=!1,t))}}initThemeToggle(){const e=document.getElementById("theme-toggle-button"),t=document.getElementById("theme-icon");if(!e||!t)return;const i=localStorage.getItem("theme"),s=window.matchMedia("(prefers-color-scheme: dark)").matches,n=i||(s?"dark":"light");this.setTheme(n),e.addEventListener("click",()=>{const e=document.documentElement.classList.contains("dark")?"light":"dark";this.setTheme(e),localStorage.setItem("theme",e)}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{localStorage.getItem("theme")||this.setTheme(e.matches?"dark":"light")})}setTheme(e){const t=document.documentElement,i=document.getElementById("theme-icon");"dark"===e?(t.classList.add("dark"),i&&(i.classList.remove("fa-sun"),i.classList.add("fa-moon"))):(t.classList.remove("dark"),i&&(i.classList.remove("fa-moon"),i.classList.add("fa-sun")))}initSidebar(){const e=document.getElementById("sidebar-toggle"),t=document.getElementById("sidebar");e&&t&&(e.addEventListener("click",()=>{if(t.classList.toggle("open"),e.classList.toggle("active"),t.classList.contains("open")){const e=document.getElementById("notification-badge");e&&(e.style.display="none")}}),document.addEventListener("click",i=>{t.contains(i.target)||e.contains(i.target)||(t.classList.remove("open"),e.classList.remove("active"))}))}initStarRating(){const e=document.getElementById("review-rating");if(!e)return;const t=e.querySelectorAll(".star"),i=document.getElementById("rating-value");let s=0;t.forEach((e,n)=>{e.addEventListener("mouseenter",()=>{this.highlightStars(t,n+1)}),e.addEventListener("mouseleave",()=>{this.highlightStars(t,s)}),e.addEventListener("click",()=>{s=n+1,i.value=s,this.highlightStars(t,s)})})}highlightStars(e,t){e.forEach((e,i)=>{i<t?e.classList.add("active"):e.classList.remove("active")})}initReviewForm(){const e=document.getElementById("review-form"),t=document.getElementById("review-counter"),i=document.getElementById("review-text");i&&t&&i.addEventListener("input",()=>{const e=i.value.length;t.textContent=e,t.style.color=e>1e3?"#ff4757":"var(--text-secondary)"}),e&&e.addEventListener("submit",async t=>{t.preventDefault(),await this.handleReviewSubmission(e)})}async handleReviewSubmission(e){const t=new FormData(e);if("0"===Object.fromEntries(t.entries()).rating)return void this.showNotification('<i class="fas fa-star"></i> Пожалуйста, поставьте оценку',"error");const i=e.querySelector('button[type="submit"]'),s=i.innerHTML;i.innerHTML='<i class="fas fa-spinner fa-spin"></i> Отправляем...',i.disabled=!0;try{await new Promise(e=>setTimeout(e,1500)),this.showNotification('<i class="fas fa-check-circle"></i> Отзыв успешно отправлен! Он будет опубликован после модерации.',"success"),e.reset(),document.getElementById("rating-value").value="0",document.getElementById("review-counter").textContent="0",this.highlightStars(document.querySelectorAll("#review-rating .star"),0)}catch(e){this.showNotification('<i class="fas fa-times-circle"></i> Ошибка при отправке отзыва',"error")}finally{i.innerHTML=s,i.disabled=!1}}initQuiz(){document.getElementById("quiz-modal")&&setTimeout(()=>{localStorage.getItem("quiz-completed")||this.showQuizPrompt()},5e3)}showQuizPrompt(){const e=document.getElementById("quiz-modal");e&&e.classList.add("active")}nextQuizStep(){if(this.currentQuizStep<this.totalQuizSteps){if(!this.validateQuizStep(this.currentQuizStep))return;document.querySelector(`[data-step="${this.currentQuizStep}"]`).style.display="none",this.currentQuizStep++,document.querySelector(`[data-step="${this.currentQuizStep}"]`).style.display="block",document.getElementById("quiz-prev").style.display="inline-flex",this.currentQuizStep===this.totalQuizSteps&&(document.getElementById("quiz-next").style.display="none",document.getElementById("quiz-submit").style.display="inline-flex")}}prevQuizStep(){this.currentQuizStep>1&&(document.querySelector(`[data-step="${this.currentQuizStep}"]`).style.display="none",this.currentQuizStep--,document.querySelector(`[data-step="${this.currentQuizStep}"]`).style.display="block",1===this.currentQuizStep&&(document.getElementById("quiz-prev").style.display="none"),document.getElementById("quiz-next").style.display="inline-flex",document.getElementById("quiz-submit").style.display="none")}validateQuizStep(e){const t=document.querySelector(`[data-step="${e}"]`),i=t.querySelectorAll("[required]");for(let e of i)if("radio"===e.type||"checkbox"===e.type){const i=e.name;if(0===t.querySelectorAll(`[name="${i}"]:checked`).length)return this.showNotification('<i class="fas fa-exclamation-circle"></i> Пожалуйста, заполните все обязательные поля',"error"),!1}else if(!e.value.trim())return this.showNotification('<i class="fas fa-exclamation-circle"></i> Пожалуйста, заполните все обязательные поля',"error"),e.focus(),!1;return!0}async submitQuiz(){if(!this.validateQuizStep(this.currentQuizStep))return;const e=document.getElementById("client-quiz"),t=new FormData(e);Object.fromEntries(t.entries());try{await new Promise(e=>setTimeout(e,2e3)),this.showNotification('<i class="fas fa-check-circle"></i> Анкета успешно отправлена! Мы свяжемся с вами в ближайшее время.',"success"),localStorage.setItem("quiz-completed","true"),this.closeQuiz()}catch(e){this.showNotification('<i class="fas fa-times-circle"></i> Ошибка при отправке анкеты',"error")}}closeQuiz(){const e=document.getElementById("quiz-modal");e&&e.classList.remove("active")}startQuiz(){this.currentQuizStep=1,document.getElementById("client-quiz").reset(),document.querySelectorAll(".quiz-step").forEach((e,t)=>{e.style.display=0===t?"block":"none"}),document.getElementById("quiz-prev").style.display="none",document.getElementById("quiz-next").style.display="inline-flex",document.getElementById("quiz-submit").style.display="none",this.showQuizPrompt()}closeSidebar(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-toggle");e&&e.classList.remove("open"),t&&t.classList.remove("active")}};window.website=e,console.log("Современный психологический кабинет готов к работе!")}();
//# sourceMappingURL=main.fc20ec22b1facc1eb6c9.js.map